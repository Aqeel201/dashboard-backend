<%- include('partials/header') %>

  <!-- Inline CSS for Enhanced Design -->
  <style>
    /* Card Styles for Categories and Medicine Types */
    .category-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      min-height: 130px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      text-decoration: none;
      color: #333;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .category-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      border-color: #007bff;
    }

    .category-card.active {
      background: #007bff;
      color: #fff;
      border-color: #0056b3;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
    }

    .category-card i {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    /* Medicine Thumbnail */
    .medicine-image {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #ddd;
    }

    /* Toggle Button Styles */
    .browse-toggle {
      text-align: center;
      margin-bottom: 30px;
    }

    .browse-toggle button {
      margin: 0 15px;
      padding: 10px 20px;
      font-size: 1.1rem;
      border-radius: 25px;
      transition: all 0.3s ease;
    }

    /* Search Bar Styles */
    .search-container {
      margin-bottom: 30px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    .search-container .input-group {
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border-radius: 25px;
      overflow: hidden;
    }

    .search-container .form-control {
      border: none;
      padding: 12px 20px;
      font-size: 1rem;
    }

    .search-container .btn {
      border: none;
      padding: 12px 20px;
      background: #007bff;
      color: #fff;
      border-radius: 0 25px 25px 0;
      transition: background 0.3s ease;
    }

    .search-container .btn:hover {
      background: #0056b3;
    }

    /* Table Styles */
    .table-card {
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .table-card .card-header {
      padding: 15px 20px;
      background: linear-gradient(135deg, #007bff, #0056b3);
    }

    .table-card .card-body {
      padding: 0;
    }

    .table {
      margin-bottom: 0;
    }

    .table th {
      font-weight: 600;
      background: #f8f9fa;
      padding: 15px;
    }

    .table td {
      padding: 15px;
      vertical-align: middle;
    }

    .badge {
      font-size: 0.9rem;
      padding: 6px 12px;
      border-radius: 20px;
    }
  </style>

  <!-- Content Header -->
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-4">
        <div class="col-sm-12">
          <h1 class="text-center" style="font-size: 2.5rem; font-weight: 700; color: #333;">Pharmacy Shelf</h1>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <section class="content">
    <div class="container-fluid">
      <!-- Success/Error Messages -->
      <% if(message) { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <%= message %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <% } %>
          <% if(error) { %>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              <%= error %>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <% } %>

              <!-- Toggle Buttons: Category vs. Medicine Type -->
              <div class="browse-toggle">
                <button id="browseCategoryBtn" class="btn <%= medicineType ? 'btn-outline-primary' : 'btn-primary' %>">
                  Browse by Category
                </button>
                <button id="browseTypeBtn" class="btn <%= medicineType ? 'btn-primary' : 'btn-outline-primary' %>">
                  Browse by Medicine Type
                </button>
              </div>

              <!-- Search Bar -->
              <div class="search-container">
                <div class="input-group">
                  <input type="text" id="searchInput" class="form-control" placeholder="Search medicines by name..."
                    aria-label="Search medicines">
                  <button class="btn" type="button" id="searchBtn"><i class="fas fa-search"></i></button>
                </div>
              </div>

              <!-- Category Cards Section -->
              <div id="categoryContainer" style="display: <%= medicineType ? 'none' : 'block' %>;">
                <h3 class="text-center mb-4" style="font-size: 1.8rem; color: #555;">Browse by Category</h3>
                <div class="row justify-content-center">
                  <!-- "All Medicines" Card -->
                  <div class="col-md-2 col-sm-4 mb-4">
                    <a href="/admin/medicines?category=all&token=<%= token %>"
                      class="card category-card <%= (!selectedCategory || selectedCategory === 'all') && !medicineType ? 'active' : '' %>">
                      <div class="card-body text-center">
                        <i class="fas fa-th-large"></i>
                        <h5 class="card-title mb-0">All Medicines</h5>
                      </div>
                    </a>
                  </div>
                  <!-- Individual Category Cards -->
                  <% categories.forEach(function(cat) { %>
                    <div class="col-md-2 col-sm-4 mb-4">
                      <a href="/admin/medicines?category=<%= cat.name %>&token=<%= token %>"
                        class="card category-card <%= selectedCategory === cat.name && !medicineType ? 'active' : '' %>">
                        <div class="card-body text-center">
                          <i class="<%= cat.icon ? cat.icon : 'fas fa-pills' %>"></i>
                          <h5 class="card-title mb-0">
                            <%= cat.name %>
                          </h5>
                        </div>
                      </a>
                    </div>
                    <% }); %>
                </div>
              </div>

              <!-- Medicine Type Cards Section -->
              <div id="typeContainer" style="display: <%= medicineType ? 'block' : 'none' %>;">
                <h3 class="text-center mb-4" style="font-size: 1.8rem; color: #555;">Browse by Medicine Type</h3>
                <div class="row justify-content-center">
                  <div class="col-md-2 col-sm-4 mb-4">
                    <a href="/admin/medicines?medicineType=Tablet&token=<%= token %>"
                      class="card category-card <%= medicineType === 'Tablet' ? 'active' : '' %>">
                      <div class="card-body text-center">
                        <i class="fas fa-tablet-alt"></i>
                        <h5 class="card-title mb-0">Tablet</h5>
                      </div>
                    </a>
                  </div>
                  <div class="col-md-2 col-sm-4 mb-4">
                    <a href="/admin/medicines?medicineType=Capsule&token=<%= token %>"
                      class="card category-card <%= medicineType === 'Capsule' ? 'active' : '' %>">
                      <div class="card-body text-center">
                        <i class="fas fa-capsules"></i>
                        <h5 class="card-title mb-0">Capsule</h5>
                      </div>
                    </a>
                  </div>
                  <div class="col-md-2 col-sm-4 mb-4">
                    <a href="/admin/medicines?medicineType=Syrup&token=<%= token %>"
                      class="card category-card <%= medicineType === 'Syrup' ? 'active' : '' %>">
                      <div class="card-body text-center">
                        <i class="fas fa-prescription-bottle-alt"></i>
                        <h5 class="card-title mb-0">Syrup</h5>
                      </div>
                    </a>
                  </div>
                </div>
              </div>

              <!-- Medicine Table Section -->
              <div class="row">
                <div class="col-12">
                  <div class="card table-card">
                    <div class="card-header bg-primary text-white">
                      <h3 class="card-title mb-0">
                        <% let filterTitle="All Medicines" ; if (medicineType) { filterTitle=medicineType + " Inventory"
                          ; } else if (selectedCategory && selectedCategory !=='all' ) { filterTitle=selectedCategory
                          + " Inventory" ; } %>
                          <%= filterTitle %>
                      </h3>
                    </div>
                    <div class="card-body p-0">
                      <table class="table table-striped table-hover" id="medicineTable">
                        <thead class="bg-light">
                          <tr>
                            <th style="width: 100px">Image</th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Price (PKR)</th>
                            <th>Dosage</th>
                            <th>Stock</th>
                            <th>Category</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% if (medicines.length> 0) { %>
                            <% medicines.forEach(medicine=> { %>
                              <tr>
                                <td>
                                  <% if (medicine.image) { %>
                                    <img
                                      src="<%= medicine.image && medicine.image.startsWith('http') ? medicine.image : '/uploads/' + medicine.image %>"
                                      alt="<%= medicine.name %>" class="medicine-image">
                                    <% } else { %>
                                      <div
                                        class="medicine-image bg-secondary text-white d-flex align-items-center justify-content-center">
                                        No Image
                                      </div>
                                      <% } %>
                                </td>
                                <td class="align-middle">
                                  <%= medicine.name %>
                                </td>
                                <td class="align-middle">
                                  <%= medicine.medicineType %>
                                </td>
                                <td class="align-middle">Rs. <%= medicine.price.toLocaleString() %>
                                </td>
                                <td class="align-middle">
                                  <%= medicine.dosage || 'N/A' %>
                                </td>
                                <td class="align-middle">
                                  <span class="badge <%= medicine.quantity > 0 ? 'bg-success' : 'bg-danger' %>">
                                    <%= medicine.quantity %> in stock
                                  </span>
                                </td>
                                <td class="align-middle">
                                  <span class="badge bg-info">
                                    <%= medicine.category %>
                                  </span>
                                </td>
                              </tr>
                              <% }); %>
                                <% } else { %>
                                  <tr>
                                    <td colspan="7" class="text-center py-4">
                                      <i class="fas fa-box-open fa-2x mb-3 text-muted"></i>
                                      <h5 class="text-muted">No medicines found in this filter</h5>
                                    </td>
                                  </tr>
                                  <% } %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

    </div>
  </section>

  <!-- JavaScript for Toggle and Search -->
  <script>
    // Toggle between Category and Medicine Type views
    document.getElementById('browseCategoryBtn').addEventListener('click', function () {
      this.classList.remove('btn-outline-primary');
      this.classList.add('btn-primary');
      document.getElementById('browseTypeBtn').classList.remove('btn-primary');
      document.getElementById('browseTypeBtn').classList.add('btn-outline-primary');
      document.getElementById('categoryContainer').style.display = 'block';
      document.getElementById('typeContainer').style.display = 'none';
      window.location.href = '/admin/medicines?category=all&token=<%= token %>';
    });

    document.getElementById('browseTypeBtn').addEventListener('click', function () {
      this.classList.remove('btn-outline-primary');
      this.classList.add('btn-primary');
      document.getElementById('browseCategoryBtn').classList.remove('btn-primary');
      document.getElementById('browseCategoryBtn').classList.add('btn-outline-primary');
      document.getElementById('categoryContainer').style.display = 'none';
      document.getElementById('typeContainer').style.display = 'block';
      if (!<%= medicineType ? 'true' : 'false' %>) {
      window.location.href = '/admin/medicines?medicineType=Tablet&token=<%= token %>';
    }
  });

    // Search Functionality
    document.getElementById('searchInput').addEventListener('input', function () {
      const searchTerm = this.value.toLowerCase();
      const rows = document.querySelectorAll('#medicineTable tbody tr');

      rows.forEach(row => {
        const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
        if (name.includes(searchTerm)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });

      // Update "No medicines found" message visibility
      const visibleRows = Array.from(rows).filter(row => row.style.display !== 'none');
      const noResultsRow = document.querySelector('#medicineTable tbody tr td[colspan="7"]');
      if (visibleRows.length === 0 && noResultsRow) {
        noResultsRow.parentElement.style.display = '';
      } else if (noResultsRow) {
        noResultsRow.parentElement.style.display = 'none';
      }
    });
  </script>

  <%- include('partials/footer') %>